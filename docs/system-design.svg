<svg viewBox="0 0 900 620" xmlns="http://www.w3.org/2000/svg" font-family="'Courier New', monospace">
  <!-- Background -->
  <rect width="900" height="620" fill="#0d1117"/>
  
  <!-- Title -->
  <text x="450" y="40" text-anchor="middle" fill="#e6edf3" font-size="20" font-weight="bold" letter-spacing="2">REDIRECT SERVICE — SYSTEM DESIGN</text>
  <line x1="100" y1="52" x2="800" y2="52" stroke="#30363d" stroke-width="1"/>

  <!-- CLIENT -->
  <rect x="30" y="80" width="140" height="60" rx="6" fill="#161b22" stroke="#388bfd" stroke-width="1.5"/>
  <text x="100" y="105" text-anchor="middle" fill="#388bfd" font-size="11" font-weight="bold">CLIENT</text>
  <text x="100" y="122" text-anchor="middle" fill="#8b949e" font-size="9">Browser / curl</text>
  <text x="100" y="136" text-anchor="middle" fill="#8b949e" font-size="9">PowerShell</text>

  <!-- Arrow: Client → Axum -->
  <line x1="170" y1="110" x2="240" y2="110" stroke="#388bfd" stroke-width="1.5" marker-end="url(#arrowBlue)"/>
  <text x="205" y="103" text-anchor="middle" fill="#388bfd" font-size="8">HTTP</text>

  <!-- AXUM SERVER -->
  <rect x="240" y="70" width="160" height="200" rx="6" fill="#161b22" stroke="#3fb950" stroke-width="1.5"/>
  <text x="320" y="93" text-anchor="middle" fill="#3fb950" font-size="11" font-weight="bold">AXUM SERVER</text>
  <text x="320" y="108" text-anchor="middle" fill="#8b949e" font-size="8">0.0.0.0:8080</text>
  <line x1="250" y1="116" x2="390" y2="116" stroke="#30363d" stroke-width="1"/>

  <!-- Routes -->
  <rect x="255" y="124" width="130" height="32" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="320" y="137" text-anchor="middle" fill="#f0883e" font-size="9" font-weight="bold">POST /shorten</text>
  <text x="320" y="150" text-anchor="middle" fill="#8b949e" font-size="8">shorten_url()</text>

  <rect x="255" y="164" width="130" height="32" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="320" y="177" text-anchor="middle" fill="#f0883e" font-size="9" font-weight="bold">GET /{short_key}</text>
  <text x="320" y="190" text-anchor="middle" fill="#8b949e" font-size="8">redirect_to_url()</text>

  <!-- Handler label -->
  <text x="320" y="225" text-anchor="middle" fill="#8b949e" font-size="8">api/handler.rs</text>
  <text x="320" y="240" text-anchor="middle" fill="#3fb950" font-size="8">Arc&lt;UrlService&gt;</text>
  <text x="320" y="255" text-anchor="middle" fill="#8b949e" font-size="8">State extraction</text>

  <!-- Arrow: Axum → Service -->
  <line x1="400" y1="170" x2="470" y2="170" stroke="#3fb950" stroke-width="1.5" marker-end="url(#arrowGreen)"/>
  <text x="435" y="163" text-anchor="middle" fill="#3fb950" font-size="8">calls</text>

  <!-- URL SERVICE -->
  <rect x="470" y="100" width="160" height="180" rx="6" fill="#161b22" stroke="#d2a8ff" stroke-width="1.5"/>
  <text x="550" y="123" text-anchor="middle" fill="#d2a8ff" font-size="11" font-weight="bold">URL SERVICE</text>
  <text x="550" y="138" text-anchor="middle" fill="#8b949e" font-size="8">service/url_service.rs</text>
  <line x1="480" y1="145" x2="620" y2="145" stroke="#30363d" stroke-width="1"/>

  <rect x="485" y="153" width="130" height="28" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="550" y="164" text-anchor="middle" fill="#d2a8ff" font-size="8" font-weight="bold">shorten(url)</text>
  <text x="550" y="176" text-anchor="middle" fill="#8b949e" font-size="7">check existing → generate → save</text>

  <rect x="485" y="188" width="130" height="28" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="550" y="199" text-anchor="middle" fill="#d2a8ff" font-size="8" font-weight="bold">resolve(short_key)</text>
  <text x="550" y="211" text-anchor="middle" fill="#8b949e" font-size="7">find → redirect</text>

  <rect x="485" y="223" width="130" height="28" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="550" y="234" text-anchor="middle" fill="#d2a8ff" font-size="8" font-weight="bold">generate_unique_key()</text>
  <text x="550" y="246" text-anchor="middle" fill="#8b949e" font-size="7">rand 6-char → check collision</text>

  <!-- Arrow: Service → Repository -->
  <line x1="630" y1="190" x2="700" y2="190" stroke="#d2a8ff" stroke-width="1.5" marker-end="url(#arrowPurple)"/>
  <text x="665" y="183" text-anchor="middle" fill="#d2a8ff" font-size="8">trait</text>

  <!-- REPOSITORY -->
  <rect x="700" y="100" width="165" height="180" rx="6" fill="#161b22" stroke="#ffa657" stroke-width="1.5"/>
  <text x="782" y="123" text-anchor="middle" fill="#ffa657" font-size="11" font-weight="bold">REPOSITORY</text>
  <text x="782" y="138" text-anchor="middle" fill="#8b949e" font-size="8">url_repository.rs</text>
  <line x1="710" y1="145" x2="855" y2="145" stroke="#30363d" stroke-width="1"/>

  <rect x="715" y="153" width="135" height="22" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="782" y="168" text-anchor="middle" fill="#ffa657" font-size="8">find_by_original_url()</text>

  <rect x="715" y="181" width="135" height="22" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="782" y="196" text-anchor="middle" fill="#ffa657" font-size="8">find_by_short_key()</text>

  <rect x="715" y="209" width="135" height="22" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="782" y="224" text-anchor="middle" fill="#ffa657" font-size="8">insert(url)</text>

  <text x="782" y="255" text-anchor="middle" fill="#8b949e" font-size="7">sqlx::query!()</text>
  <text x="782" y="268" text-anchor="middle" fill="#ffa657" font-size="7">compile-time SQL check</text>

  <!-- Arrow: Repository → Postgres -->
  <line x1="782" y1="280" x2="782" y2="340" stroke="#ffa657" stroke-width="1.5" marker-end="url(#arrowOrange)"/>
  <text x="800" y="315" fill="#ffa657" font-size="8">SQL</text>

  <!-- POSTGRES -->
  <rect x="620" y="340" width="320" height="130" rx="6" fill="#161b22" stroke="#58a6ff" stroke-width="1.5"/>
  <text x="780" y="365" text-anchor="middle" fill="#58a6ff" font-size="11" font-weight="bold">POSTGRESQL</text>
  <text x="780" y="380" text-anchor="middle" fill="#8b949e" font-size="8">localhost:5432 / redirect</text>
  <line x1="630" y1="388" x2="930" y2="388" stroke="#30363d" stroke-width="1"/>

  <!-- Table -->
  <rect x="640" y="396" width="285" height="62" rx="4" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="680" y="411" fill="#58a6ff" font-size="9" font-weight="bold">urls</text>
  <line x1="640" y1="416" x2="925" y2="416" stroke="#30363d" stroke-width="0.5"/>
  <text x="655" y="429" fill="#f0883e" font-size="8">short_key</text>
  <text x="760" y="429" fill="#8b949e" font-size="8">VARCHAR(20) PRIMARY KEY</text>
  <text x="655" y="443" fill="#f0883e" font-size="8">original_url</text>
  <text x="760" y="443" font-size="8" fill="#8b949e">TEXT NOT NULL UNIQUE</text>
  <text x="655" y="457" fill="#f0883e" font-size="8">created_at</text>
  <text x="760" y="457" fill="#8b949e" font-size="8">TIMESTAMP NOT NULL</text>

  <!-- MODEL LAYER -->
  <rect x="30" y="340" width="560" height="200" rx="6" fill="#161b22" stroke="#30363d" stroke-width="1.5"/>
  <text x="310" y="363" text-anchor="middle" fill="#8b949e" font-size="11" font-weight="bold">MODEL LAYER — src/model/</text>
  <line x1="40" y1="370" x2="580" y2="370" stroke="#30363d" stroke-width="1"/>

  <!-- ShortKey -->
  <rect x="45" y="378" width="155" height="75" rx="4" fill="#0d1117" stroke="#3fb950" stroke-width="1"/>
  <text x="122" y="393" text-anchor="middle" fill="#3fb950" font-size="9" font-weight="bold">ShortKey</text>
  <text x="122" y="406" text-anchor="middle" fill="#8b949e" font-size="7">short_key.rs</text>
  <line x1="45" y1="410" x2="200" y2="410" stroke="#30363d" stroke-width="0.5"/>
  <text x="55" y="423" fill="#8b949e" font-size="7">• Newtype: ShortKey(String)</text>
  <text x="55" y="435" fill="#8b949e" font-size="7">• min 6 chars, alphanumeric</text>
  <text x="55" y="447" fill="#8b949e" font-size="7">• validated on construction</text>

  <!-- Url -->
  <rect x="215" y="378" width="155" height="75" rx="4" fill="#0d1117" stroke="#d2a8ff" stroke-width="1"/>
  <text x="292" y="393" text-anchor="middle" fill="#d2a8ff" font-size="9" font-weight="bold">Url</text>
  <text x="292" y="406" text-anchor="middle" fill="#8b949e" font-size="7">url.rs — internal domain</text>
  <line x1="215" y1="410" x2="370" y2="410" stroke="#30363d" stroke-width="0.5"/>
  <text x="225" y="423" fill="#8b949e" font-size="7">• short_key: ShortKey</text>
  <text x="225" y="435" fill="#8b949e" font-size="7">• original_url: String</text>
  <text x="225" y="447" fill="#8b949e" font-size="7">• created_at: DateTime&lt;Utc&gt;</text>

  <!-- UrlResponse -->
  <rect x="385" y="378" width="175" height="75" rx="4" fill="#0d1117" stroke="#ffa657" stroke-width="1"/>
  <text x="472" y="393" text-anchor="middle" fill="#ffa657" font-size="9" font-weight="bold">UrlResponse</text>
  <text x="472" y="406" text-anchor="middle" fill="#8b949e" font-size="7">url.rs — JSON output</text>
  <line x1="385" y1="410" x2="560" y2="410" stroke="#30363d" stroke-width="0.5"/>
  <text x="395" y="423" fill="#8b949e" font-size="7">• shortUrl: String (full URL)</text>
  <text x="395" y="435" fill="#8b949e" font-size="7">• originalUrl: String</text>
  <text x="395" y="447" fill="#8b949e" font-size="7">• createdAt: DateTime&lt;Utc&gt;</text>

  <!-- DomainError -->
  <rect x="45" y="465" width="515" height="55" rx="4" fill="#0d1117" stroke="#f85149" stroke-width="1"/>
  <text x="122" y="480" fill="#f85149" font-size="9" font-weight="bold">DomainError</text>
  <text x="230" y="480" fill="#8b949e" font-size="7">errors.rs</text>
  <line x1="45" y1="484" x2="560" y2="484" stroke="#30363d" stroke-width="0.5"/>
  <text x="55" y="497" fill="#8b949e" font-size="7">UrlNotFound → 404</text>
  <text x="200" y="497" fill="#8b949e" font-size="7">InvalidShortKey → 400</text>
  <text x="370" y="497" fill="#8b949e" font-size="7">DatabaseError(sqlx::Error) → 500</text>
  <text x="55" y="511" fill="#8b949e" font-size="7">#[from] sqlx::Error — auto converts via ? operator</text>

  <!-- FLOW LABELS -->
  <text x="450" y="590" text-anchor="middle" fill="#30363d" font-size="9">POST /shorten → validate → check existing → generate key → insert → 201 JSON</text>
  <text x="450" y="607" text-anchor="middle" fill="#30363d" font-size="9">GET /{key} → validate → lookup → 301 redirect  |  not found → 404</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#388bfd"/>
    </marker>
    <marker id="arrowGreen" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#3fb950"/>
    </marker>
    <marker id="arrowPurple" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#d2a8ff"/>
    </marker>
    <marker id="arrowOrange" markerWidth="8" markerHeight="8" refX="3" refY="6" orient="auto">
      <path d="M0,0 L6,0 L3,8 z" fill="#ffa657"/>
    </marker>
  </defs>
</svg>
